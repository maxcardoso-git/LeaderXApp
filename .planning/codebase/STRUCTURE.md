# Codebase Structure

**Analysis Date:** 2026-01-31

## Directory Layout

```
LeaderXApp/
├── src/                              # Source code root
│   ├── main.ts                       # Application bootstrap
│   ├── app.module.ts                 # Root NestJS module
│   ├── health/                       # Health check endpoints
│   ├── domains/                      # Business domains (main codebase)
│   ├── infrastructure/               # Cross-domain technical layer
│   ├── common/                       # Legacy shared utilities
│   └── shared/                       # New shared utilities
├── prisma/                           # Database schema and migrations
├── test/                             # End-to-end and integration tests
├── dist/                             # Compiled JavaScript output
├── docs/                             # API documentation
├── openapi/                          # OpenAPI/Swagger specifications
├── services/                         # External service configurations
├── package.json                      # Node dependencies and scripts
├── tsconfig.json                     # TypeScript configuration
├── nest-cli.json                     # NestJS CLI configuration
├── .eslintrc.js                      # ESLint configuration
├── Dockerfile                        # Container image definition
├── docker-compose.yml                # Local development containers
└── .planning/                        # GSD planning documents
```

## Directory Purposes

**src/domains/:**
- Purpose: Core business logic organized by bounded context/business domain
- Contains: Each domain is a self-contained module with complete vertical slice (controller → handler → domain → repository)
- Key structure: `[domain-name]/domain/`, `application/`, `inbound/`, `outbound/`

**src/infrastructure/:**
- Purpose: Shared technical infrastructure and external service integrations
- Contains: Prisma database service, OpenAPI client generators, HTTP clients, messaging adapters
- Key files:
  - `src/infrastructure/persistence/prisma.service.ts` - Database connection and lifecycle
  - `src/infrastructure/persistence/approvals/` - Approval-specific repositories
  - `src/infrastructure/openapi-clients/` - Generated clients for external APIs
  - `src/infrastructure/http/` - HTTP-level adapters
  - `src/infrastructure/messaging/` - Event/message adapters

**src/common/:**
- Purpose: Shared cross-cutting concerns (legacy structure)
- Contains:
  - `src/common/errors/` - Error base classes
  - `src/common/eventing/` - Event publishing utilities
  - `src/common/idempotency/` - Idempotency handling
  - `src/common/outbox/` - Outbox pattern implementation
  - `src/common/request-context/` - Request context management
  - `src/common/retry/` - Retry mechanisms

**src/shared/:**
- Purpose: New shared utilities structure (planned evolution from common/)
- Contains: `domain/` and `infrastructure/` subdirectories
- Status: Mostly empty in current codebase; intended for future shared code

**src/health/:**
- Purpose: Kubernetes-style health probes and service readiness
- Contains:
  - `src/health/health.controller.ts` - Endpoints: `/health`, `/health/live`, `/health/ready`
  - `src/health/health.module.ts` - Health module registration

**prisma/:**
- Purpose: Database schema and seed data
- Contains:
  - `prisma/schema.prisma` - Unified Prisma data model (all domains in one schema)
  - `prisma/migrations/` - Database migration history
  - `prisma/seed.ts` - Initial data population for development

**test/:**
- Purpose: End-to-end and integration tests
- Contains:
  - `test/jest-e2e.json` - E2E test configuration
  - Test files organized by domain or feature

**dist/:**
- Purpose: Compiled JavaScript output (generated by build)
- Contains: Transpiled TypeScript code, ready for execution
- Note: Not committed to git; generated during build

## Key File Locations

**Entry Points:**
- `src/main.ts` - Application bootstrap, port 3001, Swagger setup at `/api`
- `src/app.module.ts` - Root module, imports all domain modules and infrastructure
- `src/health/health.controller.ts` - Health probes for orchestration

**Configuration:**
- `package.json` - Dependencies, scripts, Jest config, module aliases
- `tsconfig.json` - TypeScript compiler options, path aliases (`@domain/*`, `@application/*`, etc.)
- `nest-cli.json` - NestJS build configuration
- `prisma/schema.prisma` - Database schema definition

**Core Domain Modules:**
- `src/domains/points/` - Points/ledger system (credit, debit, hold, balance)
- `src/domains/events/` - Event management (lifecycle, availability, seating)
- `src/domains/reservations/` - Reservation system with jobs/scheduling
- `src/domains/audit/` - Audit logging and compliance
- `src/domains/governance/` - Governance policies and rules
- `src/domains/identity/` - Identity and user management
- `src/domains/network/` - Network/organization relationships
- `src/domains/settings/` - Configuration and settings
- `src/domains/form-studio/` - Form builder and management
- `src/domains/plm/` - Pipeline Lifecycle Manager

**Testing:**
- `test/jest-e2e.json` - E2E test runner config
- Test files co-located with source code using `.spec.ts` or `.test.ts` suffix

## Naming Conventions

**Files:**
- Controllers: `[feature].controller.ts` (e.g., `points.controller.ts`)
- Services/Handlers: `[action]-[feature].handler.ts` or `[feature].service.ts` (e.g., `credit-points.handler.ts`)
- Entities: `[entity-name].entity.ts` (e.g., `point-account.entity.ts`)
- Repositories: `[resource].repository.ts` (e.g., `point-account.repository.ts`)
- DTOs: `[action]-[feature].dto.ts` or `*.dto.ts` (e.g., `credit-points.dto.ts`)
- Events: `[action]-[feature].event.ts` or `.event.ts` (e.g., `points-credited.event.ts`)
- Ports/Interfaces: `[resource].port.ts` or `[resource].repository.port.ts`
- Modules: `[feature].module.ts` (e.g., `points.module.ts`)
- Index files: `index.ts` for barrel exports

**Directories:**
- Domain layer: `domain/` containing `entities/`, `value-objects/`, `events/`, `services/`, `ports/`
- Application layer: `application/` containing `commands/`, `queries/`, `handlers/`, `usecases/`, `errors/`
- Inbound adapters: `inbound/` containing `controllers/`, `dtos/`
- Outbound adapters: `outbound/` containing `repositories/`, `adapters/`

**Classes:**
- PascalCase for all classes: `CreditPointsHandler`, `PointAccount`, `PointAccountRepository`
- Exception classes end with `Error`: `InsufficientFundsError`, `ValidationError`
- Service classes: Suffix with `Service` (e.g., `BalanceCalculator` is exception; usually `EventLifecycleService`)

**Constants:**
- UPPERCASE_SNAKE_CASE for port/token names: `POINT_ACCOUNT_REPOSITORY`, `IDEMPOTENCY_REPOSITORY`, `UNIT_OF_WORK`

**Types/Interfaces:**
- PascalCase: `PointsReceiptResponse`, `HealthResponse`
- Ports use `Port` suffix: `PointAccountRepositoryPort`, `UnitOfWorkPort`

## Where to Add New Code

**New Feature (use CQRS - Points, Reservations style):**
1. Create feature folder under domain: `src/domains/[feature]/`
2. Command definition: `src/domains/[feature]/application/commands/[action].command.ts`
3. Handler implementation: `src/domains/[feature]/application/handlers/[action].handler.ts`
4. Domain entity: `src/domains/[feature]/domain/entities/[entity].entity.ts`
5. Repository implementation: `src/domains/[feature]/outbound/repositories/[entity].repository.ts`
6. Controller endpoint: `src/domains/[feature]/inbound/controllers/[feature].controller.ts`
7. DTO for request/response: `src/domains/[feature]/inbound/dtos/[action].dto.ts`
8. Module registration: `src/domains/[feature]/[feature].module.ts`
9. Domain port/interface: `src/domains/[feature]/domain/ports/[entity].repository.port.ts`

**New Use Case (Events, Governance style):**
1. Feature folder: `src/domains/[feature]/`
2. Use case class: `src/domains/[feature]/application/usecases/[action].usecase.ts`
3. Domain service: `src/domains/[feature]/domain/services/[service].service.ts`
4. Repository: `src/domains/[feature]/outbound/repositories/[entity].repository.ts`
5. Controller: `src/domains/[feature]/inbound/controllers/[feature].controller.ts`
6. DTO: `src/domains/[feature]/inbound/dtos/[action].dto.ts`
7. Module: `src/domains/[feature]/[feature].module.ts`

**New Component/Module:**
- Keep domain modules self-contained
- Place shared infrastructure in `src/infrastructure/`
- Place shared utilities in `src/common/` or `src/shared/`
- Register in root module: `src/app.module.ts` imports section

**Utilities:**
- Shared helpers: `src/common/` or `src/shared/infrastructure/`
- Domain-specific helpers: `src/domains/[feature]/domain/services/`
- Infrastructure services: `src/infrastructure/`

**Database Models:**
- Add model to `prisma/schema.prisma`
- Create migration: `npm run prisma:migrate`
- Reference in domain repositories via Prisma client

**Tests:**
- Co-locate with source: `[filename].spec.ts` or `[filename].test.ts`
- E2E tests: `test/[feature].e2e.spec.ts`
- Follow Jest config in `package.json` (rootDir: src, testRegex: `.*\\.spec\\.ts$`)

## Special Directories

**dist/:**
- Purpose: Compiled output from TypeScript
- Generated: Yes (by `npm run build`)
- Committed: No (in .gitignore)
- Not modified manually; recreated on every build

**node_modules/:**
- Purpose: Installed dependencies
- Generated: Yes (by `npm install`)
- Committed: No (in .gitignore)
- Not modified manually; managed by package-lock.json

**prisma/migrations/:**
- Purpose: Database migration history
- Generated: Yes (by `npm run prisma:migrate`)
- Committed: Yes (part of version control)
- Manual edits: Rarely; use Prisma CLI for migration generation

**services/:**
- Purpose: External service configuration or client setup files
- Generated: No
- Committed: Yes
- Used for: Third-party service integrations

**openapi/:**
- Purpose: OpenAPI schema documentation
- Generated: Partially (by Swagger generation in main.ts)
- Committed: Yes
- Accessible at: `/api` endpoint when running

**docs/:**
- Purpose: Additional project documentation
- Generated: No
- Committed: Yes
- Manual content: Architecture decisions, API guides, runbooks

## Module Architecture Pattern

**Standard Domain Module Structure:**

```typescript
// Module file: src/domains/[feature]/[feature].module.ts
@Module({
  controllers: [FeatureController],
  providers: [
    PrismaService,
    // Port implementations (repositories, adapters)
    { provide: ENTITY_REPOSITORY, useClass: EntityRepository },
    { provide: SERVICE_PORT, useClass: ServiceAdapter },
    // Handlers/Use Cases
    ActionHandler,
    QueryHandler,
    // Domain Services
    DomainService,
  ],
  exports: [
    // Export for use in other modules
    { provide: ENTITY_REPOSITORY, useClass: EntityRepository },
  ],
})
export class FeatureModule {}
```

**Dependency Injection Pattern:**
- Ports are injected using `@Inject(PORT_TOKEN)` decorator
- Each domain module provides its repositories and services
- Cross-domain communication via exported providers
- Global services (CQRS, Config) imported at root module

---

*Structure analysis: 2026-01-31*
